# Recibir tokens
Es muy probable que quieran hacer algún contrato que permita un depósito en otro token que no sea NEAR. Por ejemplo, podrían optar recibir StNEAR cuyo valor es siempre mayor al de NEAR y con un APY de alrededor del 8% al momento de escribir esto por sobre NEAR. 

También podría pasar que quieran vender su propio token, tal vez aceptando USDT a cambio.

Para esto, tenemos que poder gestionar la recepción de tokens y alguna acción particular. No es tan sencillo como tener una función en nuestro contrato, porque el usuario para poder transferir el token, no tiene que llamar a nuestro contrato, sino a otro contrato de un NEP141. Estos contratos, cuando se transfiere un token, llamarán a una función llamada `ft_on_transfer` del receptor. Por defecto, está función está vacía y no hace nada. 

Veamos como podemos implementarla en el archivo `deposit.rs`

## Testeo
El testeo lo haremos de forma manual, porque tenemos que involucrar otra cuenta y otro token. Si no tienen tokens, les aconsejo crearse una cuenta de testnet que sea definitivamente suya y que con los NEAR del faucet entren en la página de testnet de [Meta Pool](https://testnet.metapool.app) y yendo a la sección de staking, intercambien su NEAR por StNEAR y prueben con eso.

Una vez que tengan su StNEAR, pueden transferir desde la consola de comando de dos maneras distintas, aunque primero tendremos que hacer otro paso:

```
# Necesario para que el contrato de Meta Pool tenga para pagar por el almacenamiento de la información de la cuenta que va a recibir. Esto es bastante estándar cuando se almacena información de cuentas. Solo es necesario hacer este llamado una vez.
near call meta-v2.pool.testnet storage_deposit '{"account_id": "near-tuto-2.testnet", "registration_only": true}' --accountId silkking.testnet --depositYocto 1 --gas 300000000000000
```

```
# De esta forma, estamos transfiriendo los tokens asumiendo que el receptor no es un contrato, con lo que no se llamará a la función ft_on_transfer ni ninguna de las otras posibles, con lo que no recibiremos el refund.
near call meta-v2.pool.testnet ft_transfer '{"receiver_id": "near-tuto-2.testnet", "amount": "10000000000000000000000000"}' --accountId silkking.testnet --depositYocto 1 --gas 300000000000000
```

```
# De esta forma, estamos transfiriendo los tokens asumiendo que el receptor es un contrato, con lo que se llamará a la función ft_on_transfer o alguna de las otras posibles, con lo que recibiremos el refund y podremos ver los logs en la transacción.
near call meta-v2.pool.testnet ft_transfer_call '{"receiver_id": "near-tuto-2.testnet", "amount": "10000000000000000000000000", "msg": "random message"}' --accountId silkking.testnet --depositYocto 1 --gas 300000000000000
```

## Otras posibilidades
Existe también `nft_on_transfer` en caso que recibamos un nft y se maneja de la misma manera o podríamos hacer nuestra propia callback. Hay otras opciones, pero son menos comunes.